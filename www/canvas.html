<html>
<head>
<title>Canvas</title>
<style>
</style>
</head>

<body>

<script>
  nodes=[];
  edges=[];
  edgez=[];
  pool=[];
  colors=[]
  edgest=0;
  edgefirst=0;
  colorpool=["red","black","yellow","blue","coral","crimson","darkblue","gray"];
  function coloring(){
	var len=nodes.length;
	var colornum=1;
	colors[0]=1;
	pool[0]=0;
	for(var i=1; i<=len; i++) {
		colors[i]=0;
		pool[i]=0;
	}
	for (var i=1; i<len; i++){
		for(var j=0; j<=colornum; j++){
			pool[j]=0;
		}
		for(var j=0; j<edgez[i].length;j++){
			pool[colors[edgez[i][j]]]=1;
		}
		for(var j=1; j<=colornum; j++){
			if (pool[j]==0){
				colors[i]=j;
				break;
			}
		}
		if (colors[i]==0){
			colornum++;
			colors[i]=colornum;
			if (colornum>colorpool.length){
				colorpool.push('#'+Math.floor(Math.random()*16777215).toString(16));
			}
		}
	}
	for (var j=1; j<=colornum; j++){
		for (var k=0; k<len;k++){
			if(colors[k]==j){
				nodes[k].color=colorpool[j-1];
			}
		}
	}
	draw.call();
	return;
  }
  function draw(){
	var canvas = document.getElementById("draw_canvas");
	var context = canvas.getContext("2d");
	for (var i=0; i<nodes.length; i++){
		var x=nodes[i].xcoord;
		var y=nodes[i].ycoord;
		var color=nodes[i].color
		context.beginPath();
		context.arc(x,y,20,0,2*Math.PI);
		context.strokeStyle = "black";
		context.fillStyle = color;
		context.stroke();
		context.fill();
	}
  }
  function clickFunction(event) {
    var canvas = document.getElementById("draw_canvas");
    var context = canvas.getContext("2d");
    event = event || window.event;
    var x = event.pageX - canvas.offsetLeft;
    var y = event.pageY - canvas.offsetTop;
	var atnode=-1;
	for (var i=0; i<nodes.length; i++){
		var dist=Math.pow(nodes[i].xcoord-x,2)+Math.pow(nodes[i].ycoord-y,2);
		if (dist<400){
			atnode=i;
			break;
		}
	}
    if(edgest==0&&atnode==-1){
	nodes[nodes.length]={xcoord:x, ycoord:y, color:"black"};
	context.beginPath();
    context.arc(x,y,20,0,2*Math.PI);
    context.strokeStyle = "black";
    context.fillStyle = "red";
    context.stroke();
    context.fill();
	edgez.push([]);
    }
	else{
		if (edgest==0){
			edgefirst=atnode;
			edgest=1;
		}
		else {
		//cancel edgest anyways, draw edge if it is a node and just cancel selection otherwise
			edgest=0;
			if(atnode!=-1&&atnode!=edgefirst){
				context.beginPath();
				context.moveTo(nodes[atnode].xcoord,nodes[atnode].ycoord);
				context.lineTo(nodes[edgefirst].xcoord,nodes[edgefirst].ycoord);
				context.stroke();
				edgez[edgefirst].push(atnode);
				edgez[atnode].push(edgefirst);
				edgez[edgefirst].sort(function(a,b){return a-b});
				edgez[atnode].sort(function(a,b){return a-b});
				edges[edges.length]={first:edgefirst, second:atnode};
				coloring.call();
			}
		}
	
	}
    
  }
</script>

<center>
  <canvas id="draw_canvas" width="200" height="200" style="border:1px solid #000000;" onclick="clickFunction();"></canvas>
</center>

<script>
  var canvas = document.getElementById("draw_canvas");
  canvas.width = screen.width-50;;
  canvas.height = screen.height-150;
</script>

</body>

</html>
